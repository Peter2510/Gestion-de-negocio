<div *ngIf="loading" class="fixed inset-0 bg-black bg-opacity-70 flex flex-col justify-center items-center z-50">
  <span class="loading loading-dots text-base-content text-4xl mb-2"></span>
  <p class="text-base-content text-lg">Cargando</p>
</div>


<!-- navbar.component.html -->
<div class="navbar bg-base-100 z-10 fixed top-0 left-0 right-0" *ngIf="!loading">
  <div class="flex-1 flex items-center">
    <img class="w-20 h-10 rounded md:w-40 md:h-20" [src]="empresa?.logo">
    <a href="/administrador/panel-administrador" class="text-xl text-base-content ml-2">{{ empresa?.nombre }}</a>
  </div>

  <div class="flex-none gap-2 items-center">
    <!-- Pantallas pequeñas -->
    <div class="md:hidden">
      <div class="dropdown dropdown-end">
        <label tabindex="0" class="btn btn-ghost">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"
            ></path>
          </svg>
        </label>
        <ul
          tabindex="0"
          class="menu menu-compact dropdown-content bg-base-100 rounded-box w-52"
        >
        <li>
          <label class="grid cursor-pointer place-items-center">
              <input
                type="checkbox"
                value="retro"
                (change)="toggleTheme($event)"
                [checked]="isBusinnesTheme"
                class="toggle theme-controller bg-base-content col-span-2 col-start-1 row-start-1" />
            <svg
              class="stroke-base-100 fill-base-100 col-start-1 row-start-1"
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round">
              <circle cx="12" cy="12" r="5" />
              <path
                d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" />
            </svg>
            <svg
              class="stroke-base-100 fill-base-100 col-start-2 row-start-1"
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </label>
        </li>
        <li>
          <select class="select w-full truncate" (change)="onSelectChange($event)">
            <option disabled selected>Gestión de reservaciones</option>
            <option value="/administrador/vista-servicio">
              Ver reservaciones
            </option>
            <option value="/administrador/crear-servicio">
              Crear reservaciones
            </option>
          </select>
        </li>
        <li>
          <select class="select w-full truncate" (change)="onSelectChange($event)">
            <option disabled selected>Gestión de reservaciones</option>
            <option value="/administrador/vista-servicio">
              Ver reservaciones
            </option>
            <option value="/administrador/crear-servicio">
              Crear reservaciones
            </option>
          </select>
        </li>
        </ul>
      </div>
    </div>

    <!-- Pantallas más grandes -->
    <ul class="menu menu-horizontal p-0 hidden md:flex space-x-4">
      <li>
        <select class="select w-full truncate" (change)="onSelectChange($event)">
          <option disabled selected>Gestión de reservaciones</option>
          <option value="/administrador/vista-servicio">
            Ver reservaciones
          </option>
          <option value="/administrador/crear-servicio">
            Crear reservaciones
          </option>
        </select>
      </li>
      <li>
        <select class="select w-full truncate" (change)="onSelectChange($event)">
          <option disabled selected>Gestión de reservaciones</option>
          <option value="/administrador/vista-servicio">
            Ver reservaciones
          </option>
          <option value="/administrador/crear-servicio">
            Crear reservaciones
          </option>
        </select>
      </li>
      <li>
        <label class="grid cursor-pointer place-items-center">
            <input
              type="checkbox"
              value="retro"
              (change)="toggleTheme($event)"
              [checked]="isBusinnesTheme"
              class="toggle theme-controller bg-base-content col-span-2 col-start-1 row-start-1" />
          <svg
            class="stroke-base-100 fill-base-100 col-start-1 row-start-1"
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round">
            <circle cx="12" cy="12" r="5" />
            <path
              d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" />
          </svg>
          <svg
            class="stroke-base-100 fill-base-100 col-start-2 row-start-1"
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </label>
      </li>
    </ul>

    <button (click)="toggleNotifications()" class="btn btn-ghost btn-circle">
      <div class="indicator">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
        <span class="badge badge-xs badge-primary indicator-item">
          {{ unreadCount }}
        </span>
      </div>
    </button>
    
    <div *ngIf="showNotifications" class="absolute right-0 top-20 bg-base-100 border rounded-lg shadow-lg p-4 w-72">
      <ul class="space-y-4">
        <ng-container *ngIf="notificaciones.length; else noMessages">
          <li *ngFor="let notificacion of notificaciones" 
              [ngClass]="notificacion.leido ? 'bg-base-100' : 'bg-base-300'" 
              class="text-base-content p-2 border-b last:border-b-0">
            <h4 class="font-bold text-lg">{{ notificacion.titulo }}</h4>
            <p class="text-sm text-base-content">{{ notificacion.mensaje }}</p>
            <p class="text-xs text-base-content">{{ notificacion.fecha }}</p>
            <a *ngIf="!notificacion.leido" class="link link-hover text-blue-600" (click)="actualizarNotificacion(notificacion.id)">
              Marcar como leído
            </a>
          </li>
        </ng-container>
        <ng-template #noMessages>
          <li class="text-base-content text-center p-2">
            Sin notificaciones
          </li>
        </ng-template>
      </ul>
    </div>
    
    <!-- Avatar con Dropdown -->
    <div class="dropdown dropdown-end">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
        <div class="w-10 rounded-full">
          <img
            src="https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.webp"
          />
        </div>
      </div>
      <ul
        tabindex="0"
        class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow"
      >
        <li>
          <a class="justify-between">Mi perfil</a>
        </li>
        <li><a (click)="cerrarSesion()">Cerrar sesión</a></li>
      </ul>
    </div>
  </div>
</div>


